<!--#include virtual="style1.html" -->

Code Examples from
Chapter 9 -- Procedures <!-- EDIT CHAPTER INFO -->

<!--#include virtual="style2.html" -->

Wednesday, August 29, 2001 <!-- EDIT LAST UPDATE DATE -->

<!--#include virtual="style3.html" --><font face=Courier fixed" size=5><strong>

























# inputs: $a0 and $a1
# outputs: $v0
# saved registers: $s0, $s1
# temporary registers: $t0, $t1
# local variables: 5 integers, R, S, T, U, V
# Calls procB with 5 parameters
#
# Stack frame layout:
#	
#	| in $a1  |  68($sp)
#	| in $a0  |  64($sp)
#	|---------|
#	|    R    |  60($sp)
#	|    S    |  56($sp)
#	|    T    |  52($sp)
#	|    U    |  48($sp)
#	|    V    |  44($sp)
#       |   $t1   |  40($sp)
#       |   $t0   |  36($sp)
#       |   $ra   |  32($sp)
#       |   $s1   |  28($sp)
#       |   $s0   |  24($sp)
#       | out arg4|  20($sp)
#       | out $a3 |  16($sp)
#       | out $a2 |  12($sp)
#       | out $a1 |   8($sp)
#       | out $a0 |   4($sp)
#	|---------|
#       |         | <-- $sp












procA:
	# procedure prologue
	sub $sp, $sp, 60	#allocate activation record, includes
				# space for maximum outgoing args
	sw $ra, 32($sp)		#save return address
	sw $s0, 24($sp)		# save 'saved' registers to stack
	sw $s1, 28($sp)		# save 'saved' registers to stack
	# end prologue

	....	# more code

	# call setup for call to procB
  	# save current (live) parameters into caller's stack frame
	sw $a0, 64($sp)		# only needed if values are 'live'
	sw $a1, 68($sp)		# only need if values are 'live'
  	# save any registers that need to be preserved across the call
	sw $t0, 36($sp)		# only need if values are 'live'
	sw $t1, 40($sp)		# only need if values are 'live'
	# put parameters into proper location
	lw $a0, 60($sp)		# load parameter
	lw $a1, 56($sp)		# ditto
	lw $a2, 52($sp)		# ditto
	lw $a3, 48($sp)		# ditto
	lw $t0, 44($sp)		# ditto
	sw $t0, 20($sp)		# outgoing arg4 must go on the stack
	#end call setup




















	# procedure call
	jal procB

	# return cleanup for call to procB
	# restore saved registers
	lw $a0, 64($sp)
	lw $a1, 68($sp)
	lw $t0, 36($sp)
	lw $t1, 40($sp)
	# return values are in $v0 and $v1

	....	# more code

	# procedure epilogue
	# restore return address
	lw $ra, 32($sp)
	# restore $s registers saved in prologue
	lw $s0, 24($sp)         
	lw $s1, 28($sp)        
	# put return values in $v0 and $v1
	mov $v0, $t0
	# deallocate stack frame
	add $sp, $sp, 60
	# return
	jr $ra

# end of procA



<!--#include virtual="style4.html" -->
